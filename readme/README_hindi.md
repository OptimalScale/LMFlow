<p align="center" width="100%">
<img src="../assets/logo.png" alt="LMFlow" style="width: 100%; min-width: 300px; display: block; margin: auto; background-color: transparent;">
</p>

# LMFlow

<h4 align="center">
    <p>
        <a href="https://github.com/OptimalScale/LMFlow/blob/main/README.md">English</a> |
        <a href="https://github.com/OptimalScale/LMFlow/blob/main/readme/README_zh-hans.md">чоАф╜Уф╕нцЦЗ</a> |
        <a href="https://github.com/OptimalScale/LMFlow/blob/main/readme/README_es.md">Espa├▒ol</a> |
        <a href="https://github.com/OptimalScale/LMFlow/blob/main/readme/README_jp.md">цЧецЬмшкЮ</a> |
        <a href="https://github.com/OptimalScale/LMFlow/blob/main/readme/README_ko.md">эХЬъ╡ньЦ┤</a> |
        <b>рд╣рд┐рдВрджреА</b>
    <p>
</h4>

рдпрд╣ рдЪреИрдЯрдЬреАрдкреАрдЯреА рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд╡рд╛рджрд┐рдд рд╣рд┐рдВрджреА рд╕рдВрд╕реНрдХрд░рдг рд╣реИ, рдпрджрд┐ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рд╣реЛ, рддреЛ рд╕рдВрдмрдВрдзрд┐рдд рдпреЛрдЧрджрд╛рдирдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд╕рд╛рде рд╣реА рдпрджрд┐ рдХреЛрдИ рд╕рд╛рдордЧреНрд░реА рдЕрдВрдЧреНрд░реЗрдЬреА рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ рднрд┐рдиреНрди рд╣реЛ рдпрд╛ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддреА рд╣реЛ, рддреЛ рдХреГрдкрдпрд╛ рдЕрдВрдЧреНрд░реЗрдЬреА рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╣реА рдорд╛рдиреНрдп рд░рдЦреЗрдВред рдзрдиреНрдпрд╡рд╛рджред

[![Code License](https://img.shields.io/badge/Code%20License-Apache_2.0-green.svg)](https://github.com/OptimalScale/LMFlow/blob/main/LICENSE)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/release/python-390/)
[![Doc](https://img.shields.io/badge/Website-Doc-ff69b4.svg)](https://optimalscale.github.io/LMFlow/)
[![Embark](https://img.shields.io/badge/discord-LMFlow-%237289da.svg?logo=discord)](https://discord.gg/u9VJNpzhvA)
[![slack badge](https://img.shields.io/badge/Slack-join-blueviolet?logo=slack&amp)](https://join.slack.com/t/lmflow/shared_invite/zt-1s6egx12s-THlwHuCjF6~JGKmx7JoJPA)
[![WeChat badge](https://img.shields.io/badge/WeChat-Join-brightgreen?logo=wechat&amp)](https://i.328888.xyz/2023/04/04/ibvpAk.jpeg)

рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░рдпреЛрдЧреНрдп, рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдФрд░ рджрдХреНрд╖ рдЯреВрд▓рдмреЙрдХреНрд╕ рдЬреЛ рдмрдбрд╝реЗ рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдореЙрдбрд▓ рдХреЛ finetune рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рд╕рднреА рд╕рдореБрджрд╛рдп рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛрдиреЗ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд┐рддреНрд░рддрд╛, рдЧрддрд┐ рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХреЗ рд╕рд╛рде рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рд▓рд╛рд░реНрдЬ рд▓реИрдВрдЧреНрд╡реЗрдЬ рдореЙрдбрд▓ рдлреЙрд░ рдСрд▓ред рд╣рдорд╛рд░реА [рджреГрд╖реНрдЯрд┐](https://github.com/OptimalScale/LMFlow#vision) рджреЗрдЦреЗрдВред

<p align="center" width="100%">
<img src="../assets/features.png" alt="LMFlow-features" style="width: 100%; min-width: 300px; display: block; margin: auto;">
</p>


## Latest News
* [2023-04-02] [Web service is online!](https://lmflow.com/)
* [2023-04-01] [Release Chinese checkpoints in model zoo: LLaMA-7B-tuned, LLaMA-13B-tuned, LLaMA-33B-tuned.](https://github.com/OptimalScale/LMFlow#model-zoo)
* [2023-04-01] [Release English checkpoints in model zoo: LLaMA-7B-medical, LLaMA-13B-medical, and LLaMA-33B-medical.](https://github.com/OptimalScale/LMFlow#model-zoo)
* [2023-03-27] [Support full tuning and lora tuning for all decoder models.](https://github.com/OptimalScale/LMFlow#supported-models) 
* [2023-03-27] [Tasked tuned model beats ChatGPT on medical domain](https://github.com/OptimalScale/LMFlow#model-performance)
* [2023-03-27] [Release code and checkpoints - version 0.0.1](https://optimalscale.github.io/LMFlow/)


## Demos

### рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд╣рдорд╛рд░реА рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдбрд╛рдЙрдирд▓реЛрдб рд╕реЗрд╡рд╛ рдХреНрд╖рдорддрд╛ рдкреВрд░реНрддрд┐ рдкрд░ рд╣реИред рд╣рдордиреЗ рдЗрд╕реЗ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд░реНрд╡рд░ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рд╣реИред рдпрджрд┐ рдЖрдк "рддреВрд░реНрддрд╛ рдПрдЪрдЯреАрдЯреАрдкреА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЕрдзрд┐рдХ рдорд╛рддреНрд░рд╛" рддреНрд░реБрдЯрд┐ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рдХреБрдЫ рдорд┐рдирдЯ рдЗрдВрддрдЬрд╛рд░ рдХрд░реЗрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред рдЖрдкрдХреА рд╕рдордЭ рдФрд░ рд╕рд╣рдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рджред ЁЯЩП

рд╣рдо рдЪрд╛рд░ рдкреНрд░рдХрд╛рд░ рдХреЗ рдбреЗрдореЛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИрдВ:

- рдСрдирд▓рд╛рдЗрди рд╕реЗрд╡рд╛: рдпрджрд┐ рдЖрдк рдХреЛрдИ рдХреЛрдб рдЪрд▓рд╛рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рдФрд░ рдмрд╕ рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЖрдкрдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди-рдЯреНрдпреВрдиреНрдб LLaMA-7B рдФрд░ LLaMA-33B рдХреЛ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЗрдиреНрд╣реЗрдВ рдЖрдЬрдорд╛ рд╕рдХреЗрдВред
- рдХреЛрд▓реИрдм рдЪреИрдЯрдмреЙрдЯ (рд╢реИрд▓): рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╢реИрд▓-рдЖрдзрд╛рд░рд┐рдд рдЪреИрдЯрдмреЙрдЯ рдЬреЛ рдЖрдкрдХреЛ рдХреЛрд▓реИрдм рдкрд░ рдПрдХ рдЪреИрдЯрдмреЙрдЯ рдЖрд╕рд╛рдиреА рд╕реЗ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
- рдХреЛрд▓реИрдм рдЪреИрдЯрдмреЙрдЯ (рд╡реЗрдм): рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╡реЗрдм-рдЖрдзрд╛рд░рд┐рдд рдЪреИрдЯрдмреЙрдЯ рдЬреЛ рдЖрдкрдХреЛ рдХреЛрд▓реИрдм рдкрд░ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рдЪреИрдЯрдмреЙрдЯ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
- рд╕реНрдерд╛рдиреАрдп рдбрд┐рдкреНрд▓реЙрдп: рд╣рдо рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдореЙрдбрд▓ / рдЪреИрдЯрдмреЙрдЯ рдХреЛ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рднреА рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рд╕рдВрд╕рд╛рдзрди рд╣реИрдВ, рддреЛ рдЖрдк рдкрд┐рдЫрд▓реЗ рддреАрди рд╡рд┐рдзрд┐рдпреЛрдВ рд╕реЗ рдмрд╣реБрдд рдмрдбрд╝реЗ рдореЙрдбрд▓ рдХреЛ рдбрд┐рдкреНрд▓реЙрдп рдХрд░ рд╕рдХрдд


[![Code License](https://img.shields.io/badge/Online%20Service-Web-green.svg)](https://lmflow.com)
[![colab badge](https://img.shields.io/badge/Colab-(shell)%20%20chatbot:%20gpt--neo-orange?logo=google-colab&amp)](https://colab.research.google.com/drive/1gvW9S6peZY3qfljdBpBbCflqaII8quQW?usp=sharing)
[![colab badge](https://img.shields.io/badge/Colab-(web)%20%20chatbot:%20gpt--neo-blue?logo=google-colab&amp)](https://colab.research.google.com/drive/1LLtiiQO-ZIIFsTKxYzGWYX9BDRc-v8dq?usp=sharing)


### Online Service
>[рд╡реЗрдм рд╕реЗрд╡рд╛](https://lmflow.com/) рдкрд░ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред рд╣рдо рджреЗрдЦрднрд╛рд▓ рдХрд░рддреЗ рд╣реБрдП LLaMA-7B-рдЯреНрдпреВрдиреНрдб рдФрд░ LLaMA-33B-рдЯреНрдпреВрдиреНрдб рдХреЛ рдСрдирд▓рд╛рдЗрди рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдХреЗ рд▓рд┐рдП рдбрд┐рдкреНрд▓реЙрдп рдХрд░рддреЗ рд╣реИрдВред рдЙрдЪреНрдЪ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рдХрд╛рд░рдг, рдХрднреА-рдХрднреА рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рджреЗ рдкрд╛рддреА рд╣реИред рдЖрдк `рд╕рдерд╛рдиреАрдп рдбрд┐рдкреНрд▓реЙрдп` рдкрд░ рдЬрд╛рдХрд░ рднреА рдЪреИрдЯрдмреЙрдЯ рдбрд┐рдкреНрд▓реЙрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Colab chatbot(shell)
<p align="center" width="100%">
<img src="../assets/colab-shell-chatbot-demo.png">
</p>

рд╣рдо Google Colab рдХреЗ T4/P100/V100 GPU рдХреЗ рд╕рд╛рде рдЪреИрдЯрдмреЙрдЯ рдХрд╛ рдПрдХ рд╕рд░рд▓ рд╢реИрд▓реА рдбреЗрдореЛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП gpt-neo-2.7b рдореЙрдбрд▓ **рдПрдХ рдмрд╣реБрдд рд╣реА рдХрдордЬреЛрд░ рдореЙрдбрд▓** рд╣реИ, рдЬреЛ рдХреЗрд╡рд▓ рдЕрдВрдЧреНрд░реЗрдЬреА рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрднреА-рдХрднреА рдЕрд╕рдВрддреЛрд╖рдЬрдирдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡рд╣ LMFlow рдХреЗ рд╕рд╛рде рдПрдХ рдмреЗрд╣рддрд░ рдореЙрдбрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреНрдп рдЙрдкрд▓рдмреНрдз рдбрд┐рдХреЛрдбрд░-рдХреЗрд╡рд▓ рдореЙрдбрд▓реЛрдВ рдХрд╛ рднреА рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ ЁЯдЧ [huggingface](https://huggingface.co/models?pipeline_tag=text-generation&sort=downloads),рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИрдВред


```sh
./scripts/run_chatbot.sh {another-model-name}
```
### Colab chatbot(web)
рд╣рдо Google Colab рдХреЗ T4/P100/V100 GPU рдХреЗ рд╕рд╛рде рдЪреИрдЯрдмреЙрдЯ рдХрд╛ рдПрдХ рд╕рд░рд▓ рд╡реЗрдм рдбреЗрдореЛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП gpt-neo-2.7b рдореЙрдбрд▓ **рдПрдХ рдмрд╣реБрдд рд╣реА рдХрдордЬреЛрд░ рдореЙрдбрд▓** рд╣реИ, рдЬреЛ рдХреЗрд╡рд▓ рдЕрдВрдЧреНрд░реЗрдЬреА рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрднреА-рдХрднреА рдЕрд╕рдВрддреЛрд╖рдЬрдирдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред





### Local Deploy
рдпрджрд┐ рдЖрдк рд╕рдВрд╕рд╛рдзрди рд░рдЦрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдореЙрдбрд▓ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЖрдкрдХреЛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдЖрдк рдПрдХ рдлреНрд▓рд╛рд╕реНрдХ рд╕рд░реНрд╡рд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдПрдХ рдмреИрдХрдПрдВрдб рд▓реЙрдиреНрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЕрдиреНрдп рдлреНрд░рдВрдЯрдПрдВрдб рдХреЛ рдЖрдЧреЗ рд╕реЗрд╡рд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) рдФрд░ рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╡реЗрдм рдлреНрд░рдВрдЯрдПрдВрдб (рдЖрдкрдХреЛ рд╕реАрдзреЗ рд╕рдВрдЪрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ)ред
```sh
cd ./service
python app.py
```

## Medical Performance

|                |  PubMedQA (ID) | MedQA-USMLE (OOD) | MedMCQA (ID) |  Average |
|:---------:|:--------:|:-----------:|:-------:|:----:|
| Human (pass)   |  60.0   |     50.0    |         |      |
| Human (expert) |    78.0   |     87.0    |  90.0   | 85.0 |
|   |      |              |    |  |
|  InstructGPT 175B   |   73.2   |     46.0    |  44.0   | 54.4 |
|    ChatGPT |    63.9   |     **57.0**    |  44.7   | 55.2 |
|      LLaMA 7B   |    5.2   |     27.1    |  24.3   | 18.9 |
|      LLaMA 33B |    1.8   |     43.4    |  30.3   | 25.2 |
|   |      |             |            |    |  |
|   Task-tuned LLaMA 7B (Full) |   **75.1**   |     44.5    |  49.9   | 56.5 |
| Task-tuned LLaMA 33B (LoRA) |  74.0  |  51.3   | **50.2**|**58.5**|

LLaMA 33B (LoRA) рдХреА рдкреНрд░рджрд░реНрд╢рди рдпреЛрдЧреНрдпрддрд╛ рдПрдХ рдПрдХрд▓ 8 * A100 рд╕рд░реНрд╡рд░ рдкрд░ PubMedQA рдФрд░ MedMCQA рдХреЗ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╕реНрдкреНрд▓рд┐рдЯ рдкрд░ рдХреЗрд╡рд▓ **~16 рдШрдВрдЯреЗ** рдХреА рдлрд╛рдЗрдирдЯреНрдпреВрдирд┐рдВрдЧ рд╕реЗ рд╣рд╛рд╕рд┐рд▓ рдХреА рдЬрд╛рддреА рд╣реИред
рдЕрдзрд┐рдХ рдкреНрд░рджрд░реНрд╢рди, рдЙрджрд╛рд╣рд░рдг рдЯреНрдпреВрдирд┐рдВрдЧ рдкрд░рд┐рдгрд╛рдо рдЖрджрд┐ рдХреЗ рд▓рд┐рдП рдХреГрдкрдпрд╛ рд╣рдорд╛рд░реЗ [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://optimalscale.github.io/LMFlow/)
 рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░реЗрдВред
## Model Zoo
рд╣рдордиреЗ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдХреЛ рдЕрдзрд┐рдХ рдЕрднреНрдпрд╛рд╕ рдФрд░ рдЕрдиреБрдорд╛рди рдХреЗ рд▓рд┐рдП рд╕рднреА рдХреЗ рд▓рд┐рдП рдУрдкрди-рд╕реЛрд░реНрд╕ рдХрд░ рджрд┐рдпрд╛ рд╣реИред

| Instruct-tuned Models   |  Status | Base Model | Download | 
|----------|:-------------:|----------|:-------------:|
| LLaMA-7B-tuned | ![completed](https://geps.dev/progress/100) | LLaMA-7B | [Google Drive](https://drive.google.com/file/d/1x5JLae3akVkfFeDhSe3TEyUbPn_GNFyb/view?usp=share_link) |
| LLaMA-13B-tuned | ![completed](https://geps.dev/progress/100) | LLaMA-13B |  [Google Drive](https://drive.google.com/file/d/1m_rpe6rNpN59kWvjJ3GfKeEmS-68TRYr/view?usp=share_link) |
| LLaMA-33B-tuned | ![completed](https://geps.dev/progress/100) |LLaMA-33B |  [Google Drive](https://drive.google.com/file/d/1IqgqLHwNkWQ7BffheZnqD6a-8Zul1bk6/view?usp=share_link) |
| LLaMA-65B-tuned | ![training](https://geps.dev/progress/65) | LLaMA-65B | Google Drive |
| LLaMA7B-medical | ![completed](https://geps.dev/progress/100) | LLaMA-7B | [Google Drive](https://drive.google.com/file/d/1Z44tsrRvfDFvucbNGFjHC_vbPcBvg3x-/view?usp=share_link) |
| LLaMA13B-medical | ![completed](https://geps.dev/progress/100) | LLaMA-13B |  [Google Drive](https://drive.google.com/file/d/1uoTAXTMyYQkP6N4ummx7tj-c4v1p91ap/view?usp=share_link) |
| LLaMA33B-medical | ![completed](https://geps.dev/progress/100) |LLaMA-33B |  [Google Drive](https://drive.google.com/file/d/14N9o_1pwHmVuSikQ3orMVzZDrLYJC0iM/view?usp=share_link) |
| LLaMA65B-medical | ![training](https://geps.dev/progress/90) | LLaMA-65B | Google Drive |


## Supported Pipelines

| Pipelines   |   Status |
|----------|:-------------:|
| Task Tuning |  :white_check_mark: Supported |
| Instruction Tuning |  :white_check_mark: Supported |
| Parameter-Efficient Tuning |  :white_check_mark: Supported |
| Large Model Inference |  :white_check_mark: Supported |
| Alignment Tuning |  :wrench: Developing |



## Supported Models
ЁЯдЧ huggingface рдореЗрдВ рд╕рднреА [decoder models](https://huggingface.co/models?pipeline_tag=text-generation&sort=downloads) рдХрд╛ рд╕рд╣рдЬ рддрд░реАрдХреЗ рд╕реЗ рд╕рдорд░реНрдерди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
LLaMA, GPT2, GPT-Neo, Galactica, рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЯреЗрд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд╣рдо рдЬрд▓реНрдж рд╣реА рдПрдирдХреЛрдбрд░ рдореЙрдбрд▓ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВрдЧреЗред

## 1.Setup

рд╣рдорд╛рд░реА рдкреИрдХреЗрдЬрд┐рдВрдЧ рд▓рд┐рдирдХреНрд╕ рдУрдПрд╕ (рдЙрдмрдВрдЯреВ 20.04) рдкрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЯреЗрд╕реНрдЯ рдХреА рдЧрдИ рд╣реИред рдЕрдиреНрдп рдУрдПрд╕ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо (MacOS, Windows) рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЯреЗрд╕реНрдЯ рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рд╣реИрдВред
рдЖрдк рдХреБрдЫ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рддреНрд░реБрдЯрд┐рдпреЛрдВ рд╕реЗ рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВ. рдЖрдк рдЗрд╕реЗ рдкрд╣рд▓реЗ рд▓рд┐рдирдХреНрд╕ рдорд╢реАрди рдкрд░ рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЗрд╕реЗ рдЕрдиреБрднрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреВрдЧрд▓ рдХреЛрд▓реЗрдм рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ.

```bash
git clone https://github.com/OptimalScale/LMFlow.git
cd LMFlow
conda create -n lmflow python=3.9 -y
conda activate lmflow
conda install mpi4py
pip install -e .
```

## 2.Prepare Dataset
рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдЙрджрд╛рд╣рд░рдг рдЯреНрд░реЗрдирд┐рдВрдЧ рдбреЗрдЯрд╛рд╕реЗрдЯ рдФрд░ рдЯреЗрд╕реНрдЯ рдбреЗрдЯрд╛рд╕реЗрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рд░рди рдХрд░рдХреЗ:
```bash
cd data
bash download.sh all
cd -
``` 

рдЖрдк рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдбреЗрдЯрд╛рд╕реЗрдЯ рднреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрд╡рд░реВрдк рдореЗрдВ рдХрдирд╡рд░реНрдЯ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```json
{
  "type": "text2text",
  "instances": [
    {
      "input": "Question: The Transformer architecture [START_REF]",
      "output": "N/A"
    },
    ...
  ]
}
```
```json
{
  "type": "text_only",
  "instances": [
    {
      "text": "Defintion: In this task, we ask you to write an answer to a question that involves events that may be stationary (not changing over time) or transient (changing over time). For example, the sentence \"he was born in the U.S.\" contains a stationary event since it will last forever; however, \"he is hungry\" contains a transient event since it will remain true for a short period of time. Note that a lot of the questions could have more than one correct answer. We only need a single most-likely answer. Please try to keep your \"answer\" as simple as possible. Concise and simple \"answer\" is preferred over those complex and verbose ones. \n Input: Question: Sentence: It's hail crackled across the comm, and Tara spun to retake her seat at the helm. \nQuestion: Will the hail storm ever end? \n Output: NA \n\n"
    },
    ...
  ]
}
```
## 3. Run Scripts
### 3.1 Run Finetuning

рдЖрдк рдПрдХ GPT-2 рдмреЗрд╕ рдореЙрдбрд▓ рдХреЛ рдлрд╛рдЗрдирдЯреНрдпреВрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `scripts/run_finetune.sh` рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред
```sh
./scripts/run_finetune.sh
```

рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдорд╢реАрди рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рдХреЗ рд▓рд┐рдП deepspeed рдХреЗ рд▓рд┐рдП рддрд░реНрдХ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЙрд╕рдХреЗ рд▓рд┐рдП рд╕рдВрдмрдВрдзрд┐рдд deepspeed рддрд░реНрдХ рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП,

```sh
./scripts/run_finetune.sh "--num_gpus=8 --master_port 10001"
```

LoRA рдлрд╛рдЗрдирдЯреНрдпреВрдирд┐рдВрдЧ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЗрд╕рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```sh
./scripts/run_finetune_with_lora.sh
```
рдЬреЛ рдПрдХ рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд╡рд┐рд╕реНрддреГрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП, рдЖрдк рдЗрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕реАрдзреЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпреЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреЗрд╡рд▓ рдкрд╛рдЗрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ `examples/finetune.py` рдХреЛ рдмреБрд▓рд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рдирд┐рдореНрди рддрд░реАрдХреЗ рд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

```sh
deepspeed ${deepspeed_args} \
  examples/finetune.py \
    --deepspeed configs/ds_config_zero3.json \
    --bf16 \
    --run_name finetune_with_lora \
    --model_name_or_path facebook/galactica-1.3b \
    --num_train_epochs 0.01 \
    --learning_rate 2e-5 \
    --dataset_path ${dataset_path} \
    --per_device_train_batch_size 1 \
    --per_device_eval_batch_size 1 \
    --validation_split_percentage 0 \
    --logging_steps 20 \
    --block_size 512 \
    --do_train \
    --output_dir output_models/finetune \
    --overwrite_output_dir \
    --ddp_timeout 72000 \
    --save_steps 5000 \
    --dataloader_num_workers 1
```
рдпрд╣рд╛рдВ рд╣рдо рдирдВрдмрд░ рдСрдл рдПрдкреЛрдХ рдХреЛ `--num_train_epochs` рд╢реВрдиреНрдп рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВ 0.01 рддрд╛рдХрд┐ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рддреНрд╡рд░рд┐рдд рд░реВрдк рд╕реЗ рд╕рдорд╛рдкреНрдд рд╣реЛ рд╕рдХреЗред рдпрджрд┐ рдЖрдк рдПрдХ рдмреЗрд╣рддрд░ рдкреНрд░рджрд░реНрд╢рди рд╡рд╛рд▓реЗ рдореЙрдбрд▓ рдХреА рдЗрдЪреНрдЫрд╛ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ рд╣рд╛рдЗрдкрд░рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕реНрд╡рддрдВрддреНрд░ рдорд╣рд╕реВрд╕ рдХрд░реЗрдВред рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```python
python examples/finetune.py -h
```
рд╕рднреА рд╕рдВрднрд╡ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рддрд░реНрдХ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдлрд╛рдЗрди-рдЯреНрдпреВрдиреНрдб рдореЙрдбрд▓ рдЪреЗрдХрдкреЙрдЗрдВрдЯ `--output_dir` рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рддрд░реНрдХ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ `output_models/finetune` рд╣реИред
### 3.2 Run Evaluation

рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐ рдПрдХ рдореМрдЬреВрджрд╛ рд╣рдЧрд┐рдВрдЧрдлреЗрд╕ рдореЙрдбрд▓ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, GPT2 рд▓рд╛рд░реНрдЬ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```sh
./scripts/run_evaluation.sh
```
рдпрд╛ рдлрд┐рд░ рд╕рдВрдмрдВрдзрд┐рдд рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдПрдВред
```python
CUDA_VISIBLE_DEVICES=0 \
    deepspeed examples/evaluate.py \
    --answer_type medmcqa \
    --model_name_or_path gpt2-large \
    --dataset_path data/MedQA-USMLE/validation \
    --deepspeed examples/ds_config.json
```
рдлрд╛рдЗрдирдЯреНрдпреВрдиреНрдб рдореЙрдбрд▓ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рд╣реЗрдЬреЗ рдЧрдП рдореЙрдбрд▓ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкрде рдХреЗ рд╕рд╛рде `--model_name_or_path` рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред

LoRA рдлрд╛рдЗрдирдЯреНрдпреВрдиреНрдб рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрди рджрд┐рдП рдЧрдП рд▓рд┐рдВрдХ рдкрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

```sh
./scripts/run_evaluation_with_lora.sh
```

рд╡реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣рдорд╛рд░реА API рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдмрдирд╛рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг `examples/*.py` рдХреЛ рдЕрдзрд┐рдХрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред API рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЕрдзрд┐рдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЛ `tests` рдореЗрдВ рдпреВрдирд┐рдЯрдЯреЗрд╕реНрдЯ рдореЗрдВ рджрд┐рдП рдЧрдП рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред



## 4. Additional Notes
### 4.1 LLaMA Checkpoint

1. рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ [facebookresearch/llama](https://github.com/facebookresearch/llama) рд╕реЗ LLaMA рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ `${llama-path}` рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВред

2. рджреВрд╕рд░рд╛, рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЪреЗрдХрдкреЙрдЗрдВрдЯ `${llama-path}` рдХреЛ рдЪрд▓рд╛ рдХрд░ HuggingFace рд╕рдорд░реНрдерд┐рдд рдЪреЗрдХрдкреЙрдЗрдВрдЯ `${llama-hf-path}` рдореЗрдВ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВред рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдВрдХ рдЪрд▓рд╛рдПрдБ:

    `python ./scripts/convert_llama_weights_to_hf.py --input_dir ${llama-path} --model_size 7B --output_dir ${llama-hf-path}/llama-7b-hf`

3. рдлрд┐рд░ рдЖрдк `${llama-hf-path}/llama-7b-hf` рдХреЛ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдкрде рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд░рдХреЗ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВред рдордЬрд╝рд╛ рдХрд░реЗрдВ!

4. (рд╡реИрдХрд▓реНрдкрд┐рдХ) рдЕрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдореВрд▓ llama-7b-hf pretrained рдореЙрдбрд▓ рд╣реИред
```sh
cd output_models && ./download.sh all && cd -
```
рдЖрдк рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ finetuned рдореЙрдбрд▓ рджреНрд╡рд╛рд░рд╛ рдореЙрдбрд▓ рдЕрдВрддрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред `./scripts/run_evaluation_with_lora.sh` рдХреА рддрд░рд╣ рдПрдХ рддрд░реАрдХреЗ рд╕реЗ,
```sh
CUDA_VISIBLE_DEVICES=0 \
    deepspeed examples/evaluate.py \
    --answer_type text \
    --model_name_or_path ${llama-hf-path}/llama-7b-hf \
    --lora_model_path output_models/${llama-model-diff-path} \
    --dataset_path data/alpaca/test \
    --prompt_structure "Input: {input}" \
    --deepspeed examples/ds_config.json
```
рдЕрдм рдЖрдк finetuned llama рдореЙрдбрд▓ рдХреЗ рд╕рд╛рде рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### 4.2 DeepSpeed Config
рдЖрдк DeepSpeed рдХреЛ configs рдХреЗ рддрд╣рдд рд╡рд┐рдиреНрдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╡рд┐рд╡рд░рдг рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП [DeepSpeed Configuration](https://www.deepspeed.ai/docs/config-json/) Configuration рдХрд╛ рд╕рдВрджрд░реНрдн рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред

## 5. Model Release

### 5.1 Medical Model Checkpoints
рдЖрдк рд╣рдорд╛рд░реЗ рдЪрд┐рдХрд┐рддреНрд╕рд╛ рдореЙрдбрд▓ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:

```bash
cd output_models
bash download.sh medical_ckpt
cd -
```
рдЖрдк Google Drive рд▓рд┐рдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреА рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рдХреЛ рд╕реАрдзреЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [medical_ckpt.tar.gz](https://drive.google.com/file/d/1bnsQGNGNYchsOfiNyRAmL2fNiowbmFNw/view?usp=share_link)



### 5.2 Instruction Model Checkpoints
рдЖрдк рд╣рдорд╛рд░реЗ рдирд┐рд░реНрджреЗрд╢ рдореЙрдбрд▓ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
cd output_models
bash download.sh instruction_ckpt
cd -
```
рдЖрдк Google Drive рд▓рд┐рдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреА рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рдХреЛ рд╕реАрдзреЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [instruction_ckpt.tar.gz](https://drive.google.com/file/d/1d_ioQ-ViVweeifbsFSO4pczc3UORFHZO/view?usp=share_link)

### 5.3 Begin Reproduce

рдореЙрдбрд▓ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк `LMFlow/scripts/run_evaluation_with_lora.sh` рдореЗрдВ `--lora_model_path` рдХреЛ `output_models/instruction_ckpt/llama7b-lora` (рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП llama-7b) рд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдиреЗ рдХрдиреНрд╡рд░реНрдЯ рдХрд┐рдП рдЧрдП рд▓реНрд▓рд╛рдорд╛ рдореЙрдбрд▓ рдХреЗ рд╕рд╛рде `--model_name_or_path` рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕ рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдкрд░рд┐рдгрд╛рдо рджреЛрд╣рд░рд╛рдП рдЬрд╛ рд╕рдХреЗрдВред

рдлрд┐рд░ рдЖрдк рд╣рдорд╛рд░реЗ [рдбреЙрдХ](https://optimalscale.github.io/LMFlow/) рдкрд░ рдореЙрдбрд▓ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## Documentation
рдЕрдзрд┐рдХ API рд╕рдВрджрд░реНрдн рдФрд░ рдкреНрд░рд╛рдпреЛрдЧрд┐рдХ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рдХреГрдкрдпрд╛ рд╣рдорд╛рд░реЗ [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://optimalscale.github.io/LMFlow/) рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░реЗрдВред
## Vision
рдирдорд╕реНрддреЗ! рд╣рдо рдЖрдкрдХреЛ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрддреНрд╕рд╛рд╣рд┐рдд рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реА рдХреЛрдб рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рдЖрдЧрд╛рдореА рд░рд┐рд▓реАрдЬ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рдкреВрд░реНрдг LLM рдЯреНрд░реЗрдирд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рднрд╛рд╖рд╛ рдореЙрдбрд▓ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдкреНрд░рднрд╛рд╡реА рдврдВрдЧ рд╕реЗ рдЯреНрд░реЗрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

рд╣рдорд╛рд░реА рдХреЛрдб рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрд╕ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдореЙрдбрд▓ рдирд╣реАрдВ рд╣реИ; рдЗрд╕рдореЗрдВ рдкреВрд░реНрдг рдЯреНрд░реЗрдирд┐рдВрдЧ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ, рдореЙрдбрд▓ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬреЗрд╢рди рдФрд░ рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдЯреВрд▓реНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рднрд╛рд╖рд╛ рдореЙрдбрд▓ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдмрд╛рддрдЪреАрдд рдореЙрдбрд▓, рдкреНрд░рд╢реНрди-рдЙрддреНрддрд░ рдореЙрдбрд▓ рдФрд░ рдЯреЗрдХреНрд╕реНрдЯ рдЬрдирд░реЗрд╢рди рдореЙрдбрд▓ рдЖрджрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╣рдорд╛рд░рд╛ рд▓рдХреНрд╖реНрдп рдПрдХ рдЦреБрд▓рд╛ рдФрд░ рд▓реЛрдХрддрд╛рдВрддреНрд░рд┐рдХ LLM рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХрд╛ рдордВрдЪ рдмрдирд╛рдирд╛ рд╣реИ рдЬрд╣рд╛рдВ рд▓реЛрдЧ рдЕрдкрдиреЗ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдФрд░ рдЕрдиреБрднрд╡ рд╕рд╛рдЭрд╛ рдХрд░рдХреЗ рд╕рдореБрджрд╛рдп рдХреЗ рдХреМрд╢рд▓реЛрдВ рдХреЛ рд╕рдВрдЧрдард┐рдд рдврдВрдЧ рд╕реЗ рд╕реБрдзрд╛рд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдо рдЙрди рд╕рднреА рд▓реЛрдЧреЛрдВ рдХрд╛ рд╕реНрд╡рд╛рдЧрдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ LLM рдореЗрдВ рд░реВрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдЦреБрд▓реЗ рдФрд░ рдорд┐рддреНрд░рд╡рд╛рд╣реА рд╕рдореБрджрд╛рдп рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдореЗрдВ рд╣рдорд╛рд░реЗ рд╕рд╛рде рд╢рд╛рдорд┐рд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ!

рдЪрд╛рд╣реЗ рдЖрдк рдПрдХ рд╢реБрд░реБрдЖрддреА рд╣реЛрдВ рдпрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ, рд╣рдо рдпрд╣ рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдЗрд╕ рдордВрдЪ рд╕реЗ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдУ рд╣рдо рд╕рд╛рде рдорд┐рд▓рдХрд░ рдПрдХ рдЬреАрд╡рдВрдд рдФрд░ рдирд╡рд╛рдЪрд╛рд░реА LLM рд╕рдореБрджрд╛рдп рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ!
[![Embark](https://img.shields.io/badge/discord-LMFlow-%237289da.svg?logo=discord)](https://discord.gg/u9VJNpzhvA)
[![slack badge](https://img.shields.io/badge/Slack-join-blueviolet?logo=slack&amp)](https://join.slack.com/t/lmflow/shared_invite/zt-1s6egx12s-THlwHuCjF6~JGKmx7JoJPA)
[![WeChat badge](https://img.shields.io/badge/WeChat-Join-brightgreen?logo=wechat&amp)](https://i.328888.xyz/2023/04/04/ibvpAk.jpeg)

## Disclaimer

рдпрд╣ рдкреИрдХреЗрдЬ рдмрдбрд╝реЗ рдореЙрдбрд▓ рдЯреНрдпреВрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдЪрд╛рд▓рд┐рдд рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдорд┐рддреНрд░ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИред рдЗрд╕рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рд╕рдВрджрд░реНрдн рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕реНрд░реЛрдд рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрд╡рд╛ рдХрд░рддреА рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдбреЗрдЯрд╛ рдФрд░ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓реЛрдВ рдХреА рддреИрдпрд╛рд░реА рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╣реЛрддреА рд╣реИред рдпрд╣ рдкреИрдХреЗрдЬ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рдШрдЯрдХреЛрдВ рдХреА рд╕рдЯреАрдХрддрд╛, рдкреВрд░реНрдгрддрд╛, рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдпрд╛ рдХрд╛рдиреВрдиреАрддрд╛ рдХреА рдЧрд╛рд░рдВрдЯреА рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдореЙрдбрд▓ рдФрд░ рдбреЗрдЯрд╛ рдХреА рддреИрдпрд╛рд░реА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рдЬреЛрдЦрд┐рдореЛрдВ рдФрд░ рджрд╛рдпрд┐рддреНрд╡реЛрдВ рдХреЛ рдЬрд╛рдирдиреЗ рдФрд░ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдФрд░ рдЗрд╕ рдкреИрдХреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд╛рдиреВрдиреА, рд╡рд╛рдгрд┐рдЬреНрдпрд┐рдХ рдФрд░ рддрдХрдиреАрдХреА рд╕рд▓рд╛рд╣ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреА рд╣реЛрдЧреАред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдбреЗрдЯрд╛ рдФрд░ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓реЛрдВ рдХреА рддреИрдпрд╛рд░реА рдореЗрдВ рдЕрдиреБрдЪрд┐рддрддрд╛ рд╕реЗ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдХрд┐рд╕реА рднреА рд╕реАрдзреЗ, рдЕрдкреНрд░рддреНрдпрдХреНрд╖, рд╡рд┐рд╢реЗрд╖, рд╕рдВрдп

рд╣рдорд╛рд░реЗ рдЪреЗрдХрдкреЙрдЗрдВрдЯреНрд╕ рдЬреЛ рдЕрдВрдЧреНрд░реЗрдЬреА рдФрд░ рдЪреАрдиреА рджреЛрдиреЛрдВ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдХреЗрд╡рд▓ рд╢реЛрдз рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрди рдЪреЗрдХрдкреЙрдЗрдВрдЯреНрд╕ рдореЗрдВ рд╢рд┐рдХреНрд╖рдг рдбреЗрдЯрд╛ ChatGPT рднрд╛рд╖рд╛ рдореЙрдбрд▓ рд╕реЗ рдЙрддреНрдкрдиреНрди рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред рд╣рдо рдЗрди рдЪреЗрдХрдкреЙрдЗрдВрдЯреНрд╕ рдХреЗ рд╡рд┐рддрд░рдг рдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд╛ рдЕрдиреБрд╢рдВрд╕рд┐рдд рдпрд╛ рдкреНрд░реЛрддреНрд╕рд╛рд╣рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рд╡реЗ рдХреЗрд╡рд▓ рд╢реЛрдз рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрди рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╣реЛрддреА рд╣реИ рдХрд┐ рд╡реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЗрдиреНрд╣реЗрдВ рд╕рд╣реА рдФрд░ рдЙрдЪрд┐рдд рдврдВрдЧ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдпрд╣ рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдореЙрдбрд▓ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдпреЛрдЬрд┐рдд рдореЙрдбрд▓ рдХреЗ рдкреНрд░рд╛рдпреЛрдЬрди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рд╛рдпреЛрдЬрд┐рдд рдореЙрдбрд▓ рдХреА рд╕реАрдзреА рдЬреБрдбрд╝рддреА рдирд╣реАрдВ рд╣реИрдВред рдЗрд╕ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреА рд╕рдЯреАрдХрддрд╛, рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛, рдЙрдкрдпреЛрдЧреАрддрд╛ рдФрд░ рдХрд╛рдиреВрдиреАрддрд╛ рдХреА рдЧрд╛рд░рдВрдЯреА рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрд░рд┐рдгрд╛рдореЛрдВ рд╕реЗ рдЬреБрдбрд╝реЗ рдЬреЛрдЦрд┐рдо рдФрд░ рдЬрд┐рдореНрдореЗрджрд╛рд░рд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреА рдЬрд╛рдЧрд░реВрдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдореЙрдбрд▓ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдкрд░рд┐рдгрд╛рдореЛрдВ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд╛рдиреВрдиреА, рд╡рд╛рдгрд┐рдЬреНрдпрд┐рдХ рдФрд░ рддрдХрдиреАрдХреА рд╕рд▓рд╛рд╣ рд▓реЗрдиреА рдЪрд╛рд╣рд┐рдПред рдЗрд╕ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдХрд┐рд╕реА рднреА рдкреНрд░рддреНрдпрдХреНрд╖, рдЕрдкреНрд░рддреНрдпрдХреНрд╖, рд╡рд┐рд╢реЗрд╖, рдЖрдХрд╕реНрдорд┐рдХ рдпрд╛ рдкрд░рд┐рдгрд╛рдореА рдХреНрд╖рддрд┐ рдХреЗ рд▓рд┐рдП рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░ рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдореЙрдбрд▓ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдкрд░рд┐рдгрд╛рдореЛрдВ рдкрд░ рдЖрд╢реНрд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред

## Support
рдпрджрд┐ рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА рдорджрдж рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рддреЛ, рдХреГрдкрдпрд╛ рдПрдХ [Github](https://github.com/OptimalScale/LMFlow) рдЗрд╢реБ рдкреНрд░рд╕реНрддреБрдд рдХрд░реЗрдВред
## Contributors
<a href="https://github.com/OptimalScale/LMFlow/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=OptimalScale/LMFlow" />
</a>

## Citation
рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ рд░реЗрдкреЛ рдЙрдкрдпреЛрдЧреА рд▓рдЧрддрд╛ рд╣реИ, рддреЛ рдХреГрдкрдпрд╛ тнР рджреЗрдиреЗ рдФрд░ рдЙрджреНрдзрд░рдг рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ:

```
@misc{lmflow,
  author = {Shizhe Diao and Rui Pan and Hanze Dong and KaShun Shum and Jipeng Zhang and Wei Xiong and Tong Zhang},
  title = {LMFlow: An Extensible Toolkit for Finetuning and Inference of Large Foundation Models},
  year = {2023},
  publisher = {GitHub},
  journal = {GitHub repository},
  howpublished = {\url{https://optimalscale.github.io/LMFlow/}},
}
```
